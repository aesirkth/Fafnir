/dts-v1/;
#include <st/u5/stm32u575Xg.dtsi>
#include <st/u5/stm32u575rgtx-pinctrl.dtsi>
#include <zephyr/dt-bindings/input/input-event-codes.h>

/ {
	model = "Fafnir board";

	chosen {
		zephyr,sram = &sram0;
		zephyr,flash = &flash0;
		zephyr,canbus = &fdcan1;
	};

    // aliases {
	// 	led0 = &led0;
	// };

    leds {
        compatible = "gpio-leds";
        
        led0: led_0 {
			gpios = <&gpiob 6 GPIO_ACTIVE_HIGH>;
			label = "Green LED 0";
		};
    };

	pyro {
        compatible = "gpio-leds";
        
        pyro0: pyro_0 {
			gpios = <&gpioa 8 GPIO_ACTIVE_HIGH>;
			label = "Pyro Actuate 0";
		};

		  pyro1: pyro_1 {
			gpios = <&gpioa 9 GPIO_ACTIVE_HIGH>;
			label = "Pyro Actuate 1";
		};

		  pyro2: pyro_2 {
			gpios = <&gpioa 10 GPIO_ACTIVE_HIGH>;
			label = "Pyro Actuate 2";
		};

};

	pyroSense {
        compatible = "gpio-keys";
        
        pyro0_sense: pyro_0_sense {
			gpios = <&gpiob 15 GPIO_ACTIVE_LOW>;
			label = "Pyro Sense 0";
		};

		  pyro1_sense: pyro_1_sense {
			gpios = <&gpioa 14 GPIO_ACTIVE_LOW>;
			label = "Pyro Sense 1";
		};

		  pyro2_sense: pyro_2_sense {
			gpios = <&gpiob 13 GPIO_ACTIVE_LOW>;
			label = "Pyro Sense 2";
		};
	};


    servo {
		compatible = "pwm-leds";
		status = "okay";

		servo: servo {
			pwms = <&pwm3 1 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
		};
	};


	buzzer {
		compatible = "pwm-leds";
		status = "okay";

		buzzer: buzzer {
			pwms = <&pwm4 2 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
		};
	};

};


&timers3 {
    st,prescaler = <900>;
	status = "okay";

	pwm3: pwm {
		status = "okay";
		pinctrl-0 = <&tim3_ch1_pa6>;
		pinctrl-names = "default";
	};
};

&timers4 {
    st,prescaler = <900>;
	status = "okay";

	pwm4: pwm {
		status = "okay";
		pinctrl-0 = <&tim4_ch2_pb7>;
		pinctrl-names = "default";
	};
};

&clk_hse {
    clock-frequency = <DT_FREQ_M(24)>; /* your crystal MHz */
    status = "okay";
};

&pll1 {
	div-m = <2>;
	mul-n = <30>;
	div-q = <4>;
	div-r = <4>;
	clocks = <&clk_hse>;
	status = "okay";
};

&rcc {
	clocks = <&pll1>;
	clock-frequency = <DT_FREQ_M(90)>;
	ahb-prescaler = <1>;
	apb1-prescaler = <1>;
	apb2-prescaler = <1>;
	apb3-prescaler = <1>;
};

// &fdcan1 {
// 	clocks = <&rcc STM32_CLOCK_BUS_APB1_2 0x00000200>,
// 		 <&rcc STM32_SRC_PLL1_Q FDCAN1_SEL(1)>;
// 	pinctrl-0 = <&fdcan1_rx_pb8 &fdcan1_tx_pb9>;
// 	pinctrl-names = "default";
// 	status = "okay";
// };

